---
date: "2021-10-23T17:15:13+08:00"
title: "Shell è„šæœ¬ï¼šshell å±•å¼€"
authors: Nicholas Zhan
categories:
  - shell
tags:
  - shell
draft: false
toc: true
---

Bash å’Œå…¶å®ƒ shell åšçš„å·¥ä½œè¿œä¸æ­¢æ‰§è¡Œå‘½ä»¤é‚£ä¹ˆç®€å•ã€‚ä»¥ä¸‹æåˆ°çš„å„ç§å±•å¼€ï¼ˆexpansionï¼‰æ“ä½œå‘ç”Ÿåœ¨ Bash æ‰§è¡Œå‘½ä»¤ä¹‹å‰ã€‚å‡†ç¡®æ¥è¯´ï¼Œæ˜¯åœ¨é‡å®šå‘ä¹‹å‰ï¼Œé‡å®šå‘æ“ä½œå®Œæˆä¹‹åæ‰ä¼šçœŸæ­£æ‰§è¡Œå‘½ä»¤ã€‚

> è‹¥å‘½ä»¤ä¸­å­˜åœ¨é‡å®šå‘æ“ä½œï¼Œåˆ™ Shell ä¼šåœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰è¿›è¡Œå¤„ç†ã€‚ç®¡é“ï¼ˆ`|`ï¼‰å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼ŒShell ä¼šé€æ˜åœ°å°†ä¸Šä¸€æ¡å‘½ä»¤çš„ stdout é‡å®šå‘åˆ°ä¸‹ä¸€æ¡å‘½ä»¤çš„ stdinã€‚è€Œä¸è¿™ä¸ªé‡å®šå‘æ“ä½œæœ‰å…³çš„ä¸¤æ¡å‘½ä»¤æ ¹æœ¬ä¸çŸ¥é“è‡ªå·±åœ¨å’Œè°é€šä¿¡ã€‚

åœ¨ shell å°†è¯»å–çš„å‘½ä»¤åˆ†å‰²æˆç¬¦å·ï¼ˆtokenï¼‰ä¹‹åï¼Œè¿™äº›ç¬¦å·ï¼ˆæˆ–å•è¯ï¼‰ä¼šè¢«å±•å¼€æˆ–è§£æã€‚Shell ä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œå…«ç§ç±»å‹çš„å±•å¼€ï¼š
1. Brace expansion
2. Tilde expansion
3. Shell parameter and variable expansion
4. Command substitution
5. Arithmetic expansion
6. Process substitution
7. Word splitting
8. File name expansion

## å¤§æ‹¬å·å±•å¼€

å¤§æ‹¬å·å±•å¼€çš„å½¢å¼ä¸ºï¼šä¸€ä¸ªå¯é€‰çš„å‰å¯¼ç¬¦ï¼ˆPREAMBLEï¼‰ã€ä¸€ç»„ä½äºä¸€å¯¹å¤§æ‹¬å·ä¹‹é—´çš„ç”±é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²å’Œä¸€ä¸ªå¯é€‰çš„è·‹ï¼ˆPOSTSCRIPTï¼‰ã€‚ä¾‹å¦‚ï¼š
```shell
~$ echo sp{el,il,al}l
spell spill spall
```

## æ³¢æµªå·å±•å¼€

å¦‚æœä¸€ä¸ªå•è¯ä»¥æ²¡æœ‰è¢«å¼•èµ·æ¥çš„æ³¢æµªå·ï¼ˆ~ï¼‰å¼€å§‹ï¼Œåˆ™åœ¨ç¬¬ä¸€ä¸ªæ²¡æœ‰è¢«å¼•èµ·æ¥çš„æ–œæ ï¼ˆè‹¥æ²¡æœ‰æ–œæ ï¼Œåˆ™ä¸€ç›´åˆ°æœ€åä¸€ä¸ªå­—ç¬¦ï¼‰ä¹‹å‰çš„å­—ç¬¦å°†è¢«è§†ä½œæ³¢æµªå·å‰ç¼€ï¼ˆtidle-prefixï¼‰ã€‚å¦‚æœæ³¢æµªå·å‰ç¼€ä¸­æ²¡æœ‰å­—ç¬¦è¢«å¼•èµ·æ¥ï¼Œé‚£ä¹ˆæ³¢æµªå·å‰ç¼€ä¸­çš„è¿™äº›å­—ç¬¦å°±ä¼šè¢«å½“ä½œä¸€ä¸ªå¯èƒ½çš„ç™»å½•ç”¨æˆ·åã€‚å¦‚æœè¿™ä¸ªç™»å½•ç”¨æˆ·åæ˜¯ null å­—ç¬¦ä¸²ï¼Œåˆ™æ³¢æµªå·è¢«æ›¿æ¢ä¸º shell å˜é‡ HOMEã€‚å¦‚æœ HOME å˜é‡æ²¡æœ‰è¢«è®¾ç½®ï¼Œåˆ™æ›¿æ¢ä¸ºæ‰§è¡Œè¿™ä¸ª shell çš„ç”¨æˆ·çš„ä¸»ç›®å½•ã€‚
å¦‚æœæ³¢æµªå·å‰ç¼€æ˜¯â€~+â€œï¼Œé‚£ä¹ˆå®ƒä¼šè¢«æ›¿æ¢ä¸ºå˜é‡ PWD çš„å€¼ã€‚å¦‚æœæ³¢æµªå·å‰ç¼€æ˜¯â€~-â€œï¼Œé‚£ä¹ˆå®ƒä¼šè¢«æ›¿æ¢ä¸ºå˜é‡ OLDPWD çš„å€¼ã€‚

## å‚æ•°æˆ–å˜é‡å±•å¼€

ç¾å…ƒç¬¦å·ï¼ˆ$ï¼‰ç”¨äºå‚æ•°å±•å¼€ã€å‘½ä»¤æ›¿æ¢æˆ–ç®—æœ¯å±•å¼€ã€‚è¢«å±•å¼€çš„å‚æ•°åæˆ–ç¬¦å·å¯èƒ½è¢«åŒ…è£¹åœ¨å¤§æ‹¬å·ä¸­ã€‚
æœ€åŸºæœ¬çš„å‚æ•°å±•å¼€çš„å½¢å¼æ˜¯`${PARAMETER}`ã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨æŸä¸ªå˜é‡ä¸å­˜åœ¨æ—¶åˆ›å»ºè¿™ä¸ªå˜é‡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨`${VAR:=value}`ã€‚

## å‘½ä»¤æ›¿æ¢

å‘½ä»¤æ›¿æ¢ï¼ˆcommand substitutionï¼‰å…è®¸æˆ‘ä»¬ç”¨å‘½ä»¤çš„è¾“å‡ºæ¥æ›¿æ¢å‘½ä»¤æœ¬èº«ï¼Œå®ƒæœ‰ä¸¤ç§å½¢å¼ï¼š
* $(command)
* \`command\`

å…¶ä¸­å‰è€…å·¥ä½œå¾—æ›´å¥½ï¼Œæ˜¯ç”¨æ¥å–ä»£åè€…çš„ã€‚

ä¾‹å¦‚ï¼š
```shell
~$ whoami
ubuntu2004
~$ echo `whoami`
ubuntu2004
~$ echo $(whoami)
ubuntu2004
```

å‘½ä»¤æ›¿æ¢ä¼šè°ƒç”¨ä¸€ä¸ª subshellã€‚
> A subshell is a child process launched by a shell (or shell script).

## ç®—æœ¯å±•å¼€

ç®—æœ¯å±•å¼€ï¼ˆarithmetic expansionï¼‰å…è®¸æˆ‘ä»¬ç”¨ä¸€ä¸ªç®—æœ¯è¡¨è¾¾å¼è®¡ç®—å¾—åˆ°çš„å€¼æ›¿æ¢è¡¨è¾¾å¼æœ¬èº«ã€‚å®ƒä¹Ÿæœ‰ä¸¤ç§å½¢å¼ï¼š
* `$(( EXPRESSION ))`
* \`$[ EXPRESSION ]\`

ä¾‹å¦‚ï¼š
```shell
~$ a=1
~$ echo $(( $a+1 ))
2
~$ echo $[ $a+1 ]
2
```

å¦‚æœæ‰§è¡Œç®—æœ¯è¿ç®—çš„æ“ä½œæ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«å½“ä½œ 0 å¤„ç†ã€‚ä¾‹å¦‚ï¼š
```shell
~$ a=1
~$ echo $(( $a+1 ))
1
~$ echo $[ $a+1 ]
1
```


## è¿›ç¨‹æ›¿æ¢

è¿›ç¨‹æ›¿æ¢ï¼ˆProcess substitutionï¼‰åœ¨æ”¯æŒå‘½åç®¡é“ï¼ˆFIFOï¼‰å’Œå‘½åæ‰“å¼€æ–‡ä»¶çš„ /dev/fd æ–¹æ³•çš„ç³»ç»Ÿä¸Šã€‚å½¢å¼ä¹Ÿæœ‰ä¸¤ç§ï¼š
* `<(LIST)`
* `>(LIST)`

## å•è¯æ‹†åˆ†

Shell ä¼šæ‰«æä¸åœ¨åŒå¼•å·ä¹‹å†…çš„å‚æ•°å±•å¼€ã€å‘½ä»¤æ›¿æ¢å’Œç®—æœ¯å±•å¼€çš„ç»“æœï¼Œç”¨äºå•è¯æ‹†åˆ†ã€‚åˆ†éš”ç¬¦ä¸ºå˜é‡ IFS ä¸­çš„æ¯ä¸ªå­—ç¬¦ï¼Œé»˜è®¤ä¸º `<space><tab><newline>`ã€‚


## æ–‡ä»¶åå±•å¼€

å•è¯æ‹†åˆ†ä¹‹åï¼Œå¦‚æœ bash çš„ -f é€‰é¡¹æ²¡æœ‰è¢«è®¾ç½®ï¼Œbash å°±ä¼šæ‰«ææ¯ä¸ªå•è¯ï¼Œå¯»æ‰¾å­—ç¬¦ `*`ã€`?`ã€`[`ã€‚å¦‚æœè¿™ä¸‰ä¸ªå­—ç¬¦æœ‰æ‰€å‡ºç°ï¼Œå•è¯ä¼šè¢«è§†ä¸ºä¸€ä¸ªæ¨¡å¼ï¼ˆPATTERNï¼‰ï¼Œç„¶åè¢«æ›¿æ¢ä¸ºä¸€ä¸ªä¸è¿™ä¸ªæ¨¡å¼ç›¸åŒ¹é…çš„æŒ‰ç…§å­—å…¸åºæ’åˆ—æ–‡ä»¶ååˆ—è¡¨ã€‚ä¸‰ä¸ªå­—ç¬¦çš„ä½œç”¨å„ä¸ç›¸åŒ:
* `*`ï¼šåŒ¹é…ä»»ä½•ç”±é›¶ä¸ªæˆ–ä»»æ„ä¸ªå­—ç¬¦ç»„æˆåºåˆ—ï¼ˆé™¤äº†å‰å¯¼ `.`ï¼‰
* `?`ï¼šåŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ï¼ˆé™¤äº†å‰å¯¼ `.`ï¼‰
* `[]`ï¼šåŒ¹é…ä¸€ç»„å­—ç¬¦é›†ä¸­çš„å•ä¸ªå­—ç¬¦

ä¸¾ä¸ªä¾‹å­ï¼Œå‘½ä»¤ `ls *.py` çš„ä½œç”¨æ˜¯æŸ¥è¯¢å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„ Python æºæ–‡ä»¶ã€‚å‘½ä»¤ä¸­æœ‰ä¸€ä¸ªé€šé…ç¬¦ `*`ï¼Œé‚£ä¹ˆè°è´Ÿè´£æ¥å¤„ç†è¿™ä¸ªé€šé…ç¬¦å‘¢ï¼ŸShell è¿˜æ˜¯ç¨‹åº `ls`ï¼Ÿå®é™…ä¸Šï¼Œå¤„ç† `*` çš„å¹¶ä¸æ˜¯ `ls`ï¼Œè€Œæ˜¯ Shell ï¼ˆæˆ‘ä»¥å‰ä¸€è‡´è®¤ä¸ºæ˜¯ `ls` å¤„ç†çš„é€šé…ç¬¦ğŸ¤¦â€ï¼‰ï¼Œ`ls` æ ¹æœ¬ä¸çŸ¥é“é€šé…ç¬¦çš„å­˜åœ¨ã€‚Shell ä¼šå…ˆå¯¹è¡¨è¾¾å¼ `*.py` è¿›è¡Œè®¡ç®—ï¼Œç„¶åå°†å®ƒæ›¿æ¢ä¸ºä¸æ¨¡å¼ `*.py` ç›¸åŒ¹é…çš„æ–‡ä»¶ååˆ—è¡¨ã€‚è¿™ä¸€åˆ‡éƒ½å‘ç”Ÿåœ¨ `ls` è¿è¡Œä¹‹å‰ã€‚è‹¥ `*.py` åŒ¹é…ä¸Šäº† `a.py` å’Œ `b.py` è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ™ä» `ls` çš„è§’åº¦æ¥è¯´ï¼Œæˆ‘ä»¬è¾“å…¥çš„å‘½ä»¤æ˜¯ `ls a.py b.py`ã€‚

å¦‚æœæ¨¡å¼æ²¡æœ‰åŒ¹é…ä¸Šä»»ä½•æ–‡ä»¶ï¼Œshell å°±ä¼šå°†å®ƒä»¥å­—é¢å€¼çš„å½¢å¼ä¼ é€’ç»™å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š
```shell
$ ls
a.txt
$ ls *.py
ls: cannot access '*.py': No such file or directory
```

å½“æˆ‘ä»¬ä½¿ç”¨æ¨¡å¼åŒ¹é…æ—¶ï¼Œæœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ï¼š
* è¿›è¡Œæ¨¡å¼åŒ¹é…æ“ä½œçš„æ˜¯ shellï¼Œè€Œä¸æ˜¯è¢«è°ƒç”¨çš„ç¨‹åº
* shell è¿›è¡Œçš„æ¨¡å¼åŒ¹é…åªé€‚ç”¨äºæ–‡ä»¶ï¼ˆç›®å½•ï¼‰çš„è·¯å¾„

> `grep`ã€`sed` å’Œ `awk` ç­‰ç¨‹åºæœ‰è‡ªå·±çš„æ¨¡å¼åŒ¹é…æœºåˆ¶ã€‚

## å‚è€ƒèµ„æ–™

1. [Bash Guide for Beginners](https://tldp.org/LDP/Bash-Beginners-Guide/html/index.html).
2. [Advanced Bash-Scripting Guide](https://tldp.org/LDP/abs/html/index.html).
3. [Bash Reference Manual](https://www.gnu.org/software/bash/manual/html_node/).
